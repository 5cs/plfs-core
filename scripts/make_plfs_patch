#! /bin/tcsh

set OMPI_VERSION = 1.4.3
set adio_path = /tmp/ompi-${OMPI_VERSION}/ompi/mca/io/romio/romio/adio
set patch = ad-patches/openmpi/ompi-1.4.3-plfs.patch

\rm -rf $adio_path
mkdir -p $adio_path
cp -rf ad_plfs $adio_path
/bin/cp -f ad_plfs/Makefile.am.ompi $adio_path/ad_plfs/Makefile.am

rm -f $patch; touch $patch
foreach file ( ad_plfs/*.[ch] ad_plfs/Makefile.am )
  echo "Creating patch for $file"
  diff -Naur openmpi-1.4.3/ompi/mca/io/romio/romio/adio/$file $adio_path/$file >> $patch
end
\rm -rf $adio_path

echo Your patchfile is `pwd`/$patch 
